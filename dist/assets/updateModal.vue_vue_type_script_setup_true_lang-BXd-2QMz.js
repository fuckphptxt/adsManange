var F=(p,C,u)=>new Promise((m,y)=>{var h=n=>{try{k(u.next(n))}catch(e){y(e)}},o=n=>{try{k(u.throw(n))}catch(e){y(e)}},k=n=>n.done?m(n.value):Promise.resolve(n.value).then(h,o);k((u=u.apply(p,C)).next())});import{a as K,B as T}from"./index-D4lH302q.js";import{u as q}from"./entry/index-DeA-E56H-1712476170604.js";import{j as V,m as E,l as Y,h as Z}from"./system-DR9r84eU.js";import{d as z,f as i,I as G,r as H,h as J,a7 as Q,Z as d,a8 as c,a9 as r,$ as M,u as a,k as v,ab as g,ac as W}from"./vue-BsEqlI2B.js";import{Y as w,V as B,am as X}from"./antd-DeDWztM9.js";const ee=["model"],ae=M("span",null,"暂无数据",-1),ie=z({__name:"updateModal",props:{title:{type:String,defualt:"修改密码"},password:{type:String,default:"00:00:00"},targetId:{type:Array,default:()=>["4"]},mockData:{type:Array,default:()=>[]}},emits:["okFunction"],setup(p,{emit:C}){const u=p,m=i([]),y=i(),h=i(),{password:o,mockData:k,targetId:n}=G(u),e=H({password:"",newPassword:"",account:"",role:"",manager_id:""}),I={password:[{required:!0,message:"请输入密码",trigger:"change",type:"object"}]},R=i(),P=i(),{createMessage:_}=q(),S=i(!1),x=i({}),D=C,[L,{closeModal:U,changeOkLoading:f}]=K(l=>{l&&O(l)}),N=(l,t,b)=>{m.value=l};function O(l){x.value={selectValue:l.selectValue}}const $=()=>F(this,null,function*(){f(!0),setTimeout(()=>{f(!1)},2e3),e.password&&o.value?(yield V({new_password:e.newPassword,id:o.value,type:o.value?"update":"add",username:e.account,password:e.password,role_id:e.role}),e.password="",_.success("提交成功！"),D("okFunction"),f(!1),U()):e.account&&e.password&&e.role?(yield V({type:"add",username:e.account,password:e.password,role_id:e.role,manager_id:R.value!="经理"?e.manager_id:null}),e.account="",e.password="",e.role="",e.manager_id="",_.success("提交成功！"),D("okFunction"),f(!1),U()):_.info("存在必填选项未填写"),u.title==="分配用户"&&(yield E({role_id:o.value,user_list:m.value}),_.success("提交成功！"),D("okFunction"),f(!1),U()),f(!1)}),j=()=>{e.password=""};F(this,null,function*(){const l=yield Y(),t=yield Z({role_id:""});y.value=l.list,h.value=t.list});const A=(l,t)=>{R.value=t.name};return J(()=>{m.value=n.value}),(l,t)=>{const b=Q("a-input");return d(),c(a(T),W(l.$attrs,{onRegister:a(L),title:p.title,visible:S.value,onOk:$,onVisibleChange:j}),{default:r(()=>[M("div",null,[M("form",{ref_key:"formRef",ref:P,model:e,rules:I,"label-col":{span:4},"wrapper-col":{span:14}},[a(o)&&p.title!="分配用户"?(d(),c(a(w),{key:0,label:"重置密码"},{default:r(()=>[v(b,{value:e.newPassword,"onUpdate:value":t[0]||(t[0]=s=>e.newPassword=s),placeholder:"请输入密码"},null,8,["value"])]),_:1})):g("",!0),a(o)?g("",!0):(d(),c(a(w),{key:1,label:"用户账号"},{default:r(()=>[v(b,{value:e.account,"onUpdate:value":t[1]||(t[1]=s=>e.account=s),placeholder:"请输入账号"},null,8,["value"])]),_:1})),a(o)?g("",!0):(d(),c(a(w),{key:2,label:"账号密码"},{default:r(()=>[v(b,{value:e.password,"onUpdate:value":t[2]||(t[2]=s=>e.password=s),placeholder:"请输入密码"},null,8,["value"])]),_:1})),a(o)?g("",!0):(d(),c(a(w),{key:3,label:"所属角色"},{default:r(()=>[v(a(B),{value:e.role,"onUpdate:value":t[3]||(t[3]=s=>e.role=s),"show-search":"",placeholder:"请选择角色","field-names":{label:"name",value:"id"},options:y.value,onChange:A},null,8,["value","options"])]),_:1})),R.value!="经理"&&!a(o)?(d(),c(a(w),{key:4,label:"所属经理"},{default:r(()=>[v(a(B),{value:e.manager_id,"onUpdate:value":t[4]||(t[4]=s=>e.manager_id=s),"show-search":"",placeholder:"请选择经理","field-names":{label:"username",value:"id"},options:h.value},null,8,["value","options"])]),_:1})):g("",!0),p.title==="分配用户"?(d(),c(a(w),{key:5,label:"分配用户"},{default:r(()=>[v(a(X),{"data-source":a(k),"show-search":"","list-style":{width:"250px",height:"300px"},titles:["可选择用户","已选择用户"],operations:["移入","移出"],"target-keys":m.value,render:s=>`${s.key}-${s.title}`,onChange:N},{notFoundContent:r(()=>[ae]),_:1},8,["data-source","target-keys","render"])]),_:1})):g("",!0)],8,ee)])]),_:1},16,["onRegister","title","visible"])}}});export{ie as _};
