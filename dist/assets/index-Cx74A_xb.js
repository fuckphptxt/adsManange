var Q=Object.defineProperty;var L=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var O=(u,l,t)=>l in u?Q(u,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[l]=t,$=(u,l)=>{for(var t in l||(l={}))Y.call(l,t)&&O(u,t,l[t]);if(L)for(var t of L(l))ee.call(l,t)&&O(u,t,l[t]);return u};var d=(u,l,t)=>new Promise((y,f)=>{var r=c=>{try{g(t.next(c))}catch(_){f(_)}},v=c=>{try{g(t.throw(c))}catch(_){f(_)}},g=c=>c.done?y(c.value):Promise.resolve(c.value).then(r,v);g((t=t.apply(u,l)).next())});import{_ as te}from"./componentMap-ntVNUfGj.js";import{u as ae}from"./entry/index-DeA-E56H-1712476170604.js";import"./helper-D26ItluK.js";import"./BasicForm.vue_vue_type_style_index_0_lang-BvFAdDEs.js";import{ay as oe,M as le,aX as ne,a9 as ie}from"./antd-DeDWztM9.js";import{u as se}from"./index-D4lH302q.js";import"./TableImg.vue_vue_type_style_index_0_lang-D_jLqrrq.js";import"./uuid-D0SLUWHI.js";import"./sortable.esm-CoO8jRpa.js";import{P as re}from"./index-nsw1gsVQ.js";import{vxeFlowColumns as ce,vxeTableFormSchema as de,getListId as ue}from"./tableData-B5lqcR9T.js";import{V as me}from"./index-BqTCX4sW.js";import{b as M,c as pe,f as E,h as ve}from"./work-DhQ6FW9u.js";import{_ as fe}from"./add-modal.vue_vue_type_script_setup_true_lang-D5EsDJgA.js";import{d as ge,f as i,o as _e,r as he,a7 as ye,Z as C,a8 as W,a9 as s,k as m,u as p,ac as ke,_ as D,F as xe,aa as be,a0 as we,G as R,ab as Ce,$ as Ie}from"./vue-BsEqlI2B.js";import"./useFormItem-C8SvMC7Y.js";import"./RadioButtonGroup.vue_vue_type_script_setup_true_lang-EGd22fob.js";import"./useSortable-B5C7L1iY.js";import"./download-C0dscIFQ.js";import"./base64Conver-bBv-IO2K.js";import"./index-CnUmmaWj.js";import"./IconPicker.vue_vue_type_script_setup_true_lang-BtQnCoXl.js";import"./copyTextToClipboard-CmW_HBj4.js";import"./index-eB2fGItq.js";import"./index-D77yVwLP.js";import"./useWindowSizeFn-dzDjg1EY.js";import"./onMountedOrActivated-DNS7E5S8.js";import"./useContentViewHeight-CYeOqeUw.js";const Se={class:"m-3"},at=ge({__name:"index",emits:["selectChangeEvent"],setup(u,{emit:l}){let t,y,f;const r=i([]),v=i("确定"),g=i(""),c=i("");_e(()=>d(this,null,function*(){}));const _=e=>d(this,null,function*(){const o=yield pe({flow_id:c.value});r.value=o}),N=[{title:"ID",dataIndex:"id"},{title:"任务类型ID",dataIndex:"type_id"},{title:"下一个任务执行间隔时间",dataIndex:"interval"},{title:"任务类型名称",dataIndex:"type_name"},{title:"任务流程名称",dataIndex:"flow_name"},{title:"执行错误时是否延续",slots:{customRender:"isRegron"}},{title:"步骤序号",dataIndex:"step"},{title:"操作",slots:{customRender:"actions"},width:100}],{createMessage:I}=ae(),[U,{openModal:S}]=se(),k=i(!1),A=i(""),T=i(""),F=i(),z=i("00:00:00"),x=i(),b=i(),w=i(""),q=he({id:"VxeTable",keepSource:!0,editConfig:{trigger:"click",mode:"cell",showStatus:!0},columns:ce,toolbarConfig:{buttons:[{content:"添加",buttonRender:{name:"AButton",props:{type:"primary",preIcon:"mdi:page-next-outline"},events:{click:()=>{w.value="添加任务流程",x.value="add",S(!0)}}}}]},formConfig:{enabled:!0,items:de},height:"auto",proxyConfig:{ajax:{query:h=>d(this,[h],function*({page:e,form:o}){const a=yield M($({page:e.currentPage,limit:e.pageSize},o));return{items:a,total:a.count}}),queryAll:o=>d(this,[o],function*({form:e}){return yield M(e)})}}}),H=e=>d(this,null,function*(){w.value="修改任务步骤",v.value="确定",g.value=e.interval,b.value=e.id,T.value=e.flow_id,x.value="procedureUpdate",S(!0)}),P=()=>d(this,null,function*(){var o;const e=yield M({page:1,limit:20});(o=F.value)==null||o.reloadData(e)}),j=()=>{w.value="添加任务步骤",v.value="确定",x.value="procedureAdd",S(!0)},G=e=>[{label:"查看任务步骤",onClick:()=>d(this,null,function*(){b.value=e.id,c.value=e.id,v.value="确定",_(e.id),A.value=`查看"${e.name}"的任务步骤（表格数据可拖动排序）`,k.value=!0})},{label:"删除",icon:"material-symbols:delete",color:"error",popConfirm:{title:"是否确认删除",confirm:()=>d(this,null,function*(){yield ve({handle_type:"del",id:e.id}),P(),I.success("删除成功！")})}}],X=l,B=e=>{const o=ue(e.records);X("selectChangeEvent",o)},Z=()=>d(this,null,function*(){yield E({handle_type:"order",ids:t,flow_id:b.value}),I.success("保存成功！"),k.value=!1}),J=e=>d(this,null,function*(){yield E({handle_type:"ignore_fail",id:e.id,flow_id:c.value}),I.success("修改成功！")}),K=e=>({draggable:!0,ondrag(o){y=e},ondrop(o){f=e},ondragend(o){if(y!==f){const h=r.value.indexOf(y),a=r.value.indexOf(f);[r.value[h],r.value[a]]=[r.value[a],r.value[h]];const n=[];r.value.forEach(V=>{n.push(V==null?void 0:V.id)}),v.value="保存排序",t=n}},ondragover(o){return!1}});return(e,o)=>{const h=ye("a-button");return C(),W(p(re),{contentFullHeight:"",fixedHeight:""},{default:s(()=>[m(p(me),ke({ref_key:"tableRef",ref:F},q,{onCheckboxChange:B,onCheckboxAll:B}),{toolbalSlot:s(()=>[]),action:s(({row:a})=>[m(p(te),{outside:"",actions:G(a)},null,8,["actions"])]),logSlot:s(({row:a})=>[m(p(oe),{title:"Title"},{content:s(()=>[(C(!0),D(xe,null,be(a.exec_log,n=>(C(),D("p",{key:n},we(n),1))),128))]),default:s(()=>{var n;return[((n=a.exec_log)==null?void 0:n.length)>0?(C(),W(h,{key:0,type:"primary"},{default:s(()=>[R("查看日志")]),_:1})):Ce("",!0)]}),_:2},1024)]),_:1},16),m(fe,{title:w.value,onRegister:p(U),timeValue:z.value,time:g.value,flow_id:T.value,handle_type:x.value,onOkFunction:P,onOkModal:_,accid:b.value},null,8,["title","onRegister","timeValue","time","flow_id","handle_type","accid"]),m(p(le),{visible:k.value,"onUpdate:visible":o[0]||(o[0]=a=>k.value=a),title:A.value,"ok-text":v.value,width:"50%","cancel-text":"取消",onOk:Z},{default:s(()=>[Ie("div",Se,[m(h,{type:"primary",style:{margin:"10px 0"},onClick:j},{default:s(()=>[R("添加")]),_:1}),m(p(ne),{pagination:!1,scroll:{y:600},size:"small",bordered:"",dataSource:r.value,columns:N,customRow:K},{actions:s(({record:a})=>[m(h,{type:"primary",size:"small",onClick:n=>H(a)},{default:s(()=>[R("编辑")]),_:2},1032,["onClick"])]),isRegron:s(({record:a})=>[m(p(ie),{checkedValue:1,unCheckedValue:0,"checked-children":"是","un-checked-children":"否",checked:a.ignore_fail,"onUpdate:checked":n=>a.ignore_fail=n,onChange:n=>J(a)},null,8,["checked","onUpdate:checked","onChange"])]),_:1},8,["dataSource"])])]),_:1},8,["visible","title","ok-text"])]),_:1})}}});export{at as default};
