var ne=Object.defineProperty;var F=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var E=(r,o,a)=>o in r?ne(r,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[o]=a,I=(r,o)=>{for(var a in o||(o={}))oe.call(o,a)&&E(r,a,o[a]);if(F)for(var a of F(o))ie.call(o,a)&&E(r,a,o[a]);return r};var g=(r,o,a)=>new Promise((y,f)=>{var h=m=>{try{v(a.next(m))}catch(_){f(_)}},d=m=>{try{v(a.throw(m))}catch(_){f(_)}},v=m=>m.done?y(m.value):Promise.resolve(m.value).then(h,d);v((a=a.apply(r,o)).next())});import{_ as K}from"./componentMap-ntVNUfGj.js";import{u as le}from"./entry/index-DeA-E56H-1712476170604.js";import"./helper-D26ItluK.js";import"./BasicForm.vue_vue_type_style_index_0_lang-BvFAdDEs.js";import{N as se,O as q,A as O,ay as re,K as D,a9 as ce}from"./antd-DeDWztM9.js";import{u as ue}from"./index-D4lH302q.js";import"./TableImg.vue_vue_type_style_index_0_lang-D_jLqrrq.js";import"./uuid-D0SLUWHI.js";import"./sortable.esm-CoO8jRpa.js";import{P as de}from"./index-nsw1gsVQ.js";import{V as j}from"./index-BqTCX4sW.js";import{h as C,j as z}from"./system-DR9r84eU.js";import me from"./updateModal-DaORRlV4.js";import{d as pe,f as u,r as L,a7 as ge,Z as k,a8 as M,a9 as n,k as s,u as i,$,ac as H,_ as V,F as G,aa as W,a0 as A,G as R,ab as fe}from"./vue-BsEqlI2B.js";import"./useFormItem-C8SvMC7Y.js";import"./RadioButtonGroup.vue_vue_type_script_setup_true_lang-EGd22fob.js";import"./useSortable-B5C7L1iY.js";import"./download-C0dscIFQ.js";import"./base64Conver-bBv-IO2K.js";import"./index-CnUmmaWj.js";import"./IconPicker.vue_vue_type_script_setup_true_lang-BtQnCoXl.js";import"./copyTextToClipboard-CmW_HBj4.js";import"./index-eB2fGItq.js";import"./index-D77yVwLP.js";import"./useWindowSizeFn-dzDjg1EY.js";import"./onMountedOrActivated-DNS7E5S8.js";import"./useContentViewHeight-CYeOqeUw.js";const he=[{title:"ID",field:"id",width:50},{title:"用户名",field:"username"},{title:"是否启用",field:"is_active",slots:{default:"IsShowActive"}},{title:"创建时间",field:"create_time"},{title:"最后登录时间",field:"last_login_time"},{title:"最后登录IP",field:"last_login_ip"},{title:"所属角色",field:"nickname",slots:{default:"RoleUser"}},{title:"邮箱",field:"email"},{title:"所属经理",field:"manager_name",slots:{default:"manager_name"}},{title:"操作",slots:{default:"action"},align:"center",width:300}],Z=[{title:"ID",field:"id",width:50},{title:"经理名称",field:"username",width:150},{title:"包含用户",slots:{default:"tagUser"}},{title:"操作",slots:{default:"action"},align:"center",width:300}],J=[],ve=(r=[],o="id")=>{const a=[];return r.length<=0?[]:(r.forEach(y=>{a.push(y[o])}),a)},_e={style:{height:"1050px"}},ke={style:{height:"1050px"}},We=pe({__name:"index",emits:["selectChangeEvent"],setup(r,{emit:o}){const{createMessage:a}=le(),[y,{openModal:f}]=ue(),h=u(""),d=u("3"),v=u(!1),m=u(!1),_=u(),B=u();u();const x=u([]),b=u(""),Q=u(""),P=u([]),X=L({id:"VxeTable",keepSource:!0,editConfig:{trigger:"click",mode:"cell",showStatus:!0},columns:Z,toolbarConfig:{buttons:[{content:"添加",buttonRender:{name:"AButton",props:{type:"primary",preIcon:"mdi:page-next-outline"},events:{click:()=>{b.value="",h.value="添加",f(!0)}}}}]},formConfig:{enabled:!0,items:J},height:"auto",proxyConfig:{ajax:{query:p=>g(this,[p],function*({page:t,form:l}){const e=yield C(I({page:t.currentPage,limit:t.pageSize,role_id:2},l));return d.value=="3"&&(x.value=T(e.list)),{items:e.list,total:e.count}}),queryAll:l=>g(this,[l],function*({form:t}){return yield C(t)})}}}),Y=L({id:"VxeTable",keepSource:!0,editConfig:{trigger:"click",mode:"cell",showStatus:!0},columns:d.value=="3"?he:Z,toolbarConfig:{buttons:[{content:"添加",buttonRender:{name:"AButton",props:{type:"primary",preIcon:"mdi:page-next-outline"},events:{click:()=>{b.value="",h.value="添加",f(!0)}}}}]},formConfig:{enabled:!0,items:J},height:"auto",proxyConfig:{ajax:{query:p=>g(this,[p],function*({page:t,form:l}){const e=yield C(I({page:t.currentPage,limit:t.pageSize,role_id:3},l));return d.value=="3"&&(x.value=T(e.list)),{items:e.list,total:e.count}}),queryAll:l=>g(this,[l],function*({form:t}){return yield C(t)})}}}),U=t=>[{label:"编辑",onClick:()=>{if(d.value=="2"){h.value="编辑经理",b.value=t.id;const p=t.subset,e=[];p.map(c=>{e.push(c.id)}),P.value=e,setTimeout(()=>{f(!0)},200)}}},{label:"查看广告数据",disabled:!0,onClick:()=>{}},{label:"重置密码",onClick:()=>{b.value=t.id,h.value="重置密码",f(!0)}},{label:"删除",color:"error",popConfirm:{title:"是否确认删除该用户？",confirm:()=>g(this,null,function*(){yield z({type:"del",id:t.id}),w(),a.success("删除成功")})}}],ee=o,te=t=>g(this,null,function*(){yield z({type:"is_active",id:t.id}),w(),a.success("修改成功")}),w=()=>g(this,null,function*(){var l,p;const t=yield C({role_id:d.value});d.value=="3"?((l=_.value)==null||l.reloadData(t.list),x.value=T(t.list)):(p=B.value)==null||p.reloadData(t.list)}),S=t=>{const l=ve(t.records);ee("selectChangeEvent",l)},ae=()=>{w()},T=t=>{const l=[];return t.map(p=>{l.push({key:p.id,title:p.username,name:p.manager_name})}),l};return(t,l)=>{const p=ge("a-button");return k(),M(i(de),{contentFullHeight:"",fixedHeight:"",contentClass:"p-3",contentBackground:""},{default:n(()=>[s(i(se),{activeKey:d.value,"onUpdate:activeKey":l[0]||(l[0]=e=>d.value=e),onChange:ae,size:"small",animated:!0},{default:n(()=>[s(i(q),{key:"3",tab:"普通用户列表",forceRender:v.value},{default:n(()=>[s(i(O),{spinning:m.value},{default:n(()=>[$("div",_e,[s(i(j),H({ref_key:"tableRef",ref:_},Y,{onCheckboxChange:S,onCheckboxAll:S}),{toolbalSlot:n(()=>[]),action:n(({row:e})=>[s(i(K),{outside:"",actions:U(e)},null,8,["actions"])]),logSlot:n(({row:e})=>[s(i(re),{title:"Title"},{content:n(()=>[(k(!0),V(G,null,W(e.exec_log,c=>(k(),V("p",{key:c},A(c),1))),128))]),default:n(()=>{var c;return[((c=e.exec_log)==null?void 0:c.length)>0?(k(),M(p,{key:0,type:"primary"},{default:n(()=>[R("查看日志")]),_:1})):fe("",!0)]}),_:2},1024)]),manager_name:n(({row:e})=>[s(i(D),{color:"blue"},{default:n(()=>[R(A(e.manager_name),1)]),_:2},1024)]),RoleUser:n(({row:e})=>[s(i(D),{color:"orange"},{default:n(()=>[R(A(e.nickname),1)]),_:2},1024)]),IsShowActive:n(({row:e,index:c})=>[s(i(ce),{checkedValue:1,unCheckedValue:0,"checked-children":"是","un-checked-children":"否",checked:e.is_active,"onUpdate:checked":N=>e.is_active=N,onChange:N=>te(e)},null,8,["checked","onUpdate:checked","onChange"])]),_:1},16)])]),_:1},8,["spinning"])]),_:1},8,["forceRender"]),s(i(q),{key:"2",tab:"经理用户列表",forceRender:v.value},{default:n(()=>[s(i(O),{spinning:m.value},{default:n(()=>[$("div",ke,[s(i(j),H({ref_key:"tableRefs",ref:B},X,{onCheckboxChange:S,onCheckboxAll:S}),{toolbalSlot:n(()=>[]),action:n(({row:e})=>[s(i(K),{outside:"",actions:U(e)},null,8,["actions"])]),tagUser:n(({row:e})=>[(k(!0),V(G,null,W(e.subset,c=>(k(),M(i(D),{color:"purple",key:c},{default:n(()=>[R(A(c.username),1)]),_:2},1024))),128))]),_:1},16)])]),_:1},8,["spinning"])]),_:1},8,["forceRender"])]),_:1},8,["activeKey"]),s(me,{password:b.value,title:h.value,onOkFunction:w,onRegister:i(y),mockData:x.value,originalName:Q.value,targetId:P.value},null,8,["password","title","onRegister","mockData","originalName","targetId"])]),_:1})}}});export{We as default};
